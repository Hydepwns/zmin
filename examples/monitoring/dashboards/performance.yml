# Performance alerting rules for zmin
groups:
  - name: zmin_performance
    interval: 30s
    rules:
      # Alert if throughput drops below expected thresholds
      - alert: LowThroughput
        expr: zmin_throughput_mbps < 500
        for: 5m
        labels:
          severity: warning
          mode: "{{ $labels.mode }}"
        annotations:
          summary: "Low throughput detected in {{ $labels.mode }} mode"
          description: "Throughput is {{ $value }} MB/s, below expected 500 MB/s threshold"

      - alert: CriticalLowThroughput
        expr: zmin_throughput_mbps < 100
        for: 2m
        labels:
          severity: critical
          mode: "{{ $labels.mode }}"
        annotations:
          summary: "Critical low throughput in {{ $labels.mode }} mode"
          description: "Throughput is {{ $value }} MB/s, system may be degraded"

      # Alert on high memory usage
      - alert: HighMemoryUsage
        expr: zmin_memory_usage_bytes > 1073741824  # 1GB
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High memory usage detected"
          description: "Memory usage is {{ humanize $value }}, consider using ECO mode"

      # Alert on processing errors
      - alert: ProcessingErrors
        expr: rate(zmin_errors_total[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Processing errors detected"
          description: "Error rate is {{ $value }} errors/sec"

      # Alert on high latency
      - alert: HighLatency
        expr: histogram_quantile(0.95, rate(zmin_request_duration_seconds_bucket[5m])) > 1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High processing latency"
          description: "95th percentile latency is {{ $value }}s"

  - name: zmin_gpu
    interval: 30s
    rules:
      # GPU-specific alerts
      - alert: GPUUtilizationLow
        expr: zmin_gpu_utilization_percent < 50 and zmin_gpu_enabled == 1
        for: 10m
        labels:
          severity: info
        annotations:
          summary: "GPU underutilized"
          description: "GPU utilization is {{ $value }}%, consider batching more work"

      - alert: GPUMemoryHigh
        expr: zmin_gpu_memory_used_bytes / zmin_gpu_memory_total_bytes > 0.9
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "GPU memory usage high"
          description: "GPU memory is {{ $value | humanizePercentage }} full"

  - name: zmin_availability
    interval: 30s
    rules:
      # Service availability
      - alert: ServiceDown
        expr: up{service="zmin"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Zmin service is down"
          description: "Zmin service has been down for more than 1 minute"

      - alert: BenchmarkServiceDown
        expr: up{service="zmin-benchmarks"} == 0
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Benchmark service is down"
          description: "Cannot collect benchmark metrics"